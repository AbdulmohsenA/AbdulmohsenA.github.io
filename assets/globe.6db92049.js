const s={rotationDelay:0,scaleFactor:.5,degPerSec:6,angles:{x:-100,y:-20,z:0},colors:{water:"#111",land:"#424447",country:"#E2B714",hover:"#ccc"}},e={currentCountry:null,lastTime:d3.now(),degPerMs:s.degPerSec/1e3,isDragging:!1,startX:0,startY:0,saudiArabia:null},a={current:d3.select("#current"),canvas:d3.select("#globe"),context:d3.select("#globe").node().getContext("2d")},c=d3.geoOrthographic().precision(.1),x=d3.geoPath(c).context(a.context);let m,f,u,g;const b=()=>{const t=c.rotate();t[0]=s.angles.x,t[1]=s.angles.y,t[2]=s.angles.z,c.rotate(t)},y=()=>{const t=document.documentElement.clientWidth*s.scaleFactor,n=document.documentElement.clientHeight*s.scaleFactor;a.canvas.attr("width",t).attr("height",n),c.scale(Math.min(t,n)/2).translate([t/2,n/2]),d()},w=t=>{m.restart(p,t||0)},C=t=>{e.isDragging=!0,e.startX=t.x,e.startY=t.y,m.stop()},v=t=>{if(!e.isDragging)return;const n=.25,o=(t.x-e.startX)*n,r=(t.y-e.startY)*n;e.startX=t.x,e.startY=t.y;const i=c.rotate();i[0]+=o,i[1]-=r,c.rotate(i),d()},D=()=>{e.isDragging=!1,w(s.rotationDelay)},d=()=>{const{context:t}=a,n=document.documentElement.clientWidth,o=document.documentElement.clientHeight;t.clearRect(0,0,n,o),l({type:"Sphere"},s.colors.water),l(f,s.colors.land),e.saudiArabia&&(a.current.style("color",s.colors.country),l(e.saudiArabia,s.colors.country)),e.currentCountry&&e.currentCountry!==e.saudiArabia&&(a.current.style("color","white"),l(e.currentCountry,s.colors.hover))},l=(t,n)=>{a.context.beginPath(),x(t),a.context.fillStyle=n,a.context.fill()},p=t=>{const n=d3.now(),o=n-e.lastTime;if(o<t){const r=c.rotate();r[0]+=o*e.degPerMs,c.rotate(r),d()}e.lastTime=n},j=async t=>{const n=await d3.json("https://unpkg.com/world-atlas@2.0.2/countries-110m.json");let o=await d3.tsv("https://gist.githubusercontent.com/mbostock/4090846/raw/07e73f3c2d21558489604a0bc434b3a5cf41a867/world-country-names.tsv");o[110].name="Palestine",t(n,o)},A=t=>{const n=c.invert(d3.pointer(t));return u.features.find(o=>o.geometry.coordinates.find(r=>d3.polygonContains(r,n)||r.some(i=>d3.polygonContains(i,n))))},h=t=>{const n=A(t);if(!n){e.currentCountry&&(E(),e.currentCountry=null,d());return}n!==e.currentCountry&&(e.currentCountry=n,d(),P(n))},P=t=>{var o;const n=((o=g.find(r=>parseInt(r.id)===parseInt(t.id)))==null?void 0:o.name)||"";a.current.text(n)},E=t=>{a.current.text("")},S=()=>{b(),a.canvas.call(d3.drag().on("start",C).on("drag",v).on("end",D)).on("mousemove",h).on("touchmove",h),j((t,n)=>{f=topojson.feature(t,t.objects.land),u=topojson.feature(t,t.objects.countries),g=n,e.saudiArabia=u.features.find(o=>{const r=g.find(i=>parseInt(i.id,10)===parseInt(o.id,10));return r&&r.name==="Saudi Arabia"}),window.addEventListener("resize",y),y(),m=d3.timer(p)})};export{S as init};
